<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <meta name="viewport" content="width=device-width">
    <title>Friend List</title>

	<script src="components/jquery/jquery.min.js"></script>
    <script src="vendor/hammerjs/jquery.hammer.min.js"></script>
	<script src="http://localhost/cordova.js"></script>
	<script src="components/steroids-js/steroids.js"></script>
    <script src="javascripts/onerror.js"></script>
    <script src="javascripts/console.log.js"></script>
    <link rel="stylesheet" href="vendor/topcoat/css/topcoat-mobile-light.css" />
    <link rel="stylesheet" href="stylesheets/application.css" />

	<script>
	  DrinkWithFriendsController.index();  

    // Define our Database object
    var db = null;

    // Wait for Cordova to load
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    function onDeviceReady() {
      // Create a new database
      db = window.openDatabase(
        "FriendDatabase",       // database name
        "1.0",            // database version
        "Friend ListDB",   // database display name
        200000            // database size in bytes
      );

      // populate the DB, then run a query
      db.transaction(
        populateDB,     // transaction to run; a SQLTransaction object is passed to the callback function
        databaseError,  // error callback function
        populatingDone  // success callback function; ran after the the transaction is done
      );
    }

    function populateDB(tx) {
      tx.executeSql('DROP TABLE IF EXISTS friends');
	  var sql = 
		"CREATE TABLE IF NOT EXISTS friends ( "+
		"id unique, " +
		"firstName VARCHAR(50), " +
		"lastName VARCHAR(50), " +
		"email VARCHAR(30)," + 
		"icon VARCHAR(200))";
      tx.executeSql(sql);
	  tx.executeSql("INSERT INTO friends (id,firstName,lastName,email,icon) VALUES (1,'Jessica','Mullins','jessica@gmail.com','jess.jpg')");
	  tx.executeSql("INSERT INTO friends (id,firstName,lastName,email,icon) VALUES (2,'Daniel','Garcia-Carrillo','daniel@gmail.com','daniel.jpg')");  
	  tx.executeSql("INSERT INTO friends (id,firstName,lastName,email,icon) VALUES (3,'Helen','Zhou','helen@gmail.com','helen.jpg')");  
  	  tx.executeSql("INSERT INTO friends (id,firstName,lastName,email,icon) VALUES (4,'Alex','Camargo','alex@gmail.com','alex.jpg')");  

	}

    function populatingDone(){
      db.transaction(queryDB, databaseError);
	  $('#busy').hide();
    }


    function runQuery() {
      db.transaction(queryDB, databaseError);
    }

    // Query the database
    function queryDB(tx) {
      tx.executeSql('SELECT * FROM friends', [], gotQueryResults, databaseError);
    }

    // Show the results of the database query
    function gotQueryResults(tx, results) {
	var len = results.rows.length;
      var result = "";
      result += ("friends table: " + len + " rows found. \n\n");
      for (var i=0; i<len; i++){
		var friend = results.rows.item(i);
		$('#friendList').append('<li>' +
					'<a href="friendDetails.html?id=' + friend.id + '">' +
					'<img src="http://localhost/icons/friendIcons/' + friend.icon + '" class="list-icon"/>' +
					'<p class="line1">' + friend.firstName + ' ' + friend.lastName + '</p>' +
					'<p class="line2">' + friend.email + '</p>' +
					'<span class="bubble"' + (len-1) + '</span></a></li>');
		}
		$('#status').hide();
	}

    // Transaction error callback
    function databaseError(err) {
      alert("Error code: " + err.code + "; message: " + err.message);
    }
	
</script>  
  </head>
  <body>
	<div id="header" class="header">
	<a href="friendList.html" class="action">Add+</a>
		<h1>Friend List</h1>
	</div>
	<div id="wrapper">
		<ul id="friendList" class="icon-list"></ul>
	</div>
	<div id="busy"/>Loading...</div>
  </body>
</html>
